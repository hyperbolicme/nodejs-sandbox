var zoom_out_reset_map=0;document_obj_fa.ready(function(){var a=get_final_circuit_id(),b={search_ckt_id:a,topic_subcat_id:jQuery('[id="topic_subcat_id"]').val()};paginate_fa({url:site_url_fa+"circuits/user_list",data:b,callback_fn:"draw_feeds",cntr:"#user_list_cntnr",limit:"14",offset:"14",err_callback_fn:"no_result"});show_users_count(b)});function your_network_map_creation(){createLoader();if(typeof(details)!="undefined"&&details!=""&&details!=null&&details!="[]"&&Object.keys(details).length>0){drawMap(details);jQuery("#map_location_msg").removeClass("hide")}else{empty_map_data()}}function drawMap(b){if(typeof google!="undefined"){if(b==""||b==null||Object.keys(b).length==0){jQuery("#MapCntnr").removeAttr("style");return}jQuery("#map_canvas").html("");var c=new google.maps.LatLngBounds();var a={maxZoom:6,mapTypeId:"roadmap",backgroundColor:"#FFF",minZoom:1};map=new google.maps.Map(document.getElementById("map_canvas"),a);map.setTilt(45);var g=[];noLocCnt=0,totLocCnt=b.length;var e=jQuery("#chart_url").val();jQuery.each(b,function(k,m){var o=(b[k].latitude==null||b[k].latitude=="0.00000000")?"":b[k].latitude;var j=(b[k].longitude==null||b[k].longitude=="0.00000000")?"":b[k].longitude;if(o==""&&j==""){noLocCnt++;if(noLocCnt==totLocCnt){jQuery("#MapCntnr").removeAttr("style");jQuery("#map_canvas").html(jQuery("#noDataCntnr").html()).removeAttr("style")}return}var h=new google.maps.LatLng(o,j);c.extend(h);var l=b[k].count;marker=new google.maps.Marker({position:h,map:map,title:b[k].location,icon:(e!=undefined&&e!="undefined"&&e!="")?e+"?chst=d_bubble_text_small&chld= bb|"+l+"|C6EF8C|000000":"",city_id:b[k].city_id,count:l,display_name:b[k].display_name});google.maps.event.addListener(marker,"click",(function(p,q){return function(){triggerSearch(b[q].city_id);zoom_out_reset_map=1}})(marker,k));g.push(marker);var n=google.maps.event.addListener(map,"idle",function(){if(map.getZoom()>7){map.setZoom(6)}google.maps.event.trigger(map,"resize");google.maps.event.removeListener(n)})});jQuery("#MapCntnr").removeAttr("style");jQuery("#MapCntnr").attr("style","");mapzoom=map.getZoom();google.maps.event.addListener(map,"zoom_changed",function(){var j=map.getZoom();if(mapzoom>j){if(zoom_out_reset_map==1){zoom_out_reset_map=0;jQuery("#map_click_filter").val("1");var h=jQuery("#map_click_filter").val(),i=(h!=1)?1:"";trigger_advanced_search(jQuery('a[id="your_nw_submit_btn"]'))}}mapzoom=map.getZoom()});var d={gridSize:50,maxZoom:15,zoomOnClick:false};if(typeof(MarkerClusterer)!="undefined"){var f=new MarkerClusterer(map,g,d);google.maps.event.addListener(f,"clusterclick",function(h){var l=h.getMarkers(),k="";for(var j=0;j<l.length;j++){k+=l[j].city_id+","}triggerSearch(k);zoom_out_reset_map=1});f.setCalculator(function(o,n){var j=0,m=o.length,l=m;while(l!==0){l=parseInt(l/5,10);j++}var h=0;for(var k=0;k<o.length;k++){h=parseInt(o[k].count)+parseInt(h)}j=Math.min(j,n);return{text:" ("+h+")",index:j}})}hideLoader();google.maps.event.trigger(map,"resize");setTimeout('google.maps.event.trigger(map, "resize");',300);window.onresize=function(h){google.maps.event.trigger(map,"resize")};google.maps.event.addListenerOnce(map,"idle",function(){google.maps.event.trigger(map,"resize")});map.fitBounds(c)}else{setTimeout(function(){drawMap(b)},500)}}function triggerSearch(a){jQuery("#city_ids").val(a);jQuery("#map_click_filter").val("1");var b=jQuery("#map_click_filter").val(),c=(b!=1)?1:"";trigger_advanced_search(jQuery('a[id="your_nw_submit_btn"]'))}function validateEmailInput(a){var b=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return b.test(a)}document_obj_fa.on("click",'[id^="your_nw_submit_btn"]',function(){var a=jQuery.trim(jQuery("#ul_location_radius").val());var c=jQuery.trim(jQuery("#ul_email").val());if(a!=""&&!jQuery.isNumeric(a)){jQuery(".radius_warning").show();setTimeout(function(){jQuery(".radius_warning").hide()},3000);return false}if(c!=""&&!validateEmailInput(c)){jQuery(".email_warning").show();setTimeout(function(){jQuery(".email_warning").hide()},3000);return false}var b=jQuery.trim(jQuery("#friend_name").val()),f=jQuery.trim(jQuery("#ins_name").val()),e=jQuery("#friend_loc").val(),d=jQuery("#map_click_filter").val(),g=(d!=1)?1:"";var h=serializeFormJSON("your_nw_search_form");h.search_ckt_id=get_final_circuit_id();h.topic_cat_id=jQuery('[id="topic_cat_id"]').val();h.topic_subcat_id=jQuery('[id="topic_subcat_id"]').val();show_friends_list(g,h,h)});function show_friends_list(f,e,b){jQuery('[id="quick_access_links_cntnr"]').children().removeClass("fBold");jQuery("#feeds_loader").removeClass("hide");jQuery('[id="user_list_cntnr"]').html("");var g=jQuery("#city_ids").val(),a=get_final_circuit_id(),d={search_ckt_id:a,topic_subcat_id:jQuery('[id="topic_subcat_id"]').val(),city_ids:g},c=jQuery("#map_click_filter").val();if(!e){e=d}if(!b){b=d}if(f==1){jQuery("#MapCntnr").css("position","absolute");jQuery("#MapCntnr").css("left","-99999px");jQuery('[id="map_location_msg"]').addClass("hide");createLoader()}abort_inactive_xhr();paginate_fa({initajax:1,url:site_url_fa+"circuits/user_list",data:e,callback_fn:"draw_feeds",cntr:"#user_list_cntnr",limit:"0",offset:"14",err_callback_fn:"no_result"});if(c!=1){reDrawMap(b)}show_users_count(e);jQuery("#map_click_filter").val("0");jQuery("#city_ids").val("")}function show_users_count(a){jQuery('[id="users_count_cntnr"]').html("");jQuery.ajax({type:"POST",url:site_url_fa+"circuits/show_users_count",data:a,dataType:"json",success:function(e){if(e.is_loggeddin&&e.is_loggeddin==2){return false}if(e==""||e==null||Object.keys(e).length==0){jQuery('[id="users_count_cntnr"]').html("")}else{var h=0,f=0,g=0,c="",d=0,b="";if(e["1"]){h=e["1"]}if(e["0"]){f=e["0"]}if(e["3"]){d=e["3"]}if(e.total){g=e.total}b=parseInt(f)+parseInt(d);c='<div class="row mbtm_10">\n                        <div class="col s12">\n                            <div class="left padLR15 line_height_30  mRht5">\n                           <i class="material-icons left line_height_30 green-text">&#xE8D3;</i><span class="left text_clr"><strong>All Members</strong> :'+g+'</span> </div>\n                           <div class="left padLR15 line_height_30 mRht5"> <i class="material-icons left line_height_30 orange-text">&#xE853;</i><span class="left text_clr"><strong>Registered Members</strong>: '+h+'</span></div>\n                           <div class="left padLR15 line_height_30 mRht5"><i class="material-icons left line_height_30 grey-text">&#xE85A;</i><span class="left text_clr"><strong>Unregistered Members</strong>:'+b+'</span></div>\n                        </div>\n                    </div>\n                    <div class="row mbtm_10">\n                        <div class="col s12"><div class="divider"></div></div>\n                    </div>';jQuery('[id="users_count_cntnr"]').html(c)}}})}function reDrawMap(a){jQuery.ajax({type:"POST",url:site_url_fa+"circuits/get_map_data",data:a,dataType:"json",success:function(b){var c=b.data;hideLoader();if(c==""||c==null||Object.keys(c).length==0){empty_map_data()}else{jQuery("#map_canvas").html("");drawMap(c);jQuery("#map_location_msg").removeClass("hide")}}})}function empty_map_data(){jQuery("#map_canvas").html(jQuery("#noDataCntnr").html()).removeAttr("style");jQuery("#MapCntnr").removeAttr("style");jQuery("#map_location_msg").addClass("hide");hideLoader()}document_obj_fa.on("click",'[id^="my_loc_search"]',function(){var b=jQuery("#map_click_filter").val(),d=(b!=1)?1:"";highlight_links("my_loc_search");var c={my_location:1,is_current:"1",registered:"1",non_registered:"1",search_ckt_id:jQuery('[id="base_ckt_id"]').val(),topic_subcat_id:jQuery('[id="topic_subcat_id"]').val()},a=jQuery.extend(true,{},c);show_friends_list(d,c,a)});document_obj_fa.on("click",'[id^="my_batch_search"],[id^="my_class_search"]',function(){var e=jQuery(this),f=e.attr("qs");if(jQuery.trim(f)==""){return false}highlight_links(e.attr("id"));var c=(f=="b")?{my_batch:1,is_current:"1",registered:"1",non_registered:"1",search_ckt_id:jQuery('[id="base_ckt_id"]').val(),topic_subcat_id:jQuery('[id="topic_subcat_id"]').val()}:((f=="c")?{my_class:1,is_current:"1",registered:"1",non_registered:"1",search_ckt_id:jQuery('[id="base_ckt_id"]').val(),topic_subcat_id:jQuery('[id="topic_subcat_id"]').val()}:""),a=jQuery.extend(true,{},c);a.map_data=1;var b=jQuery("#map_click_filter").val(),d=(b!=1)?1:"";show_friends_list(d,c,a)});function highlight_links(a){jQuery('[id="quick_access_links_cntnr"]').children().removeClass("fBold");jQuery('[id="'+a+'"]').addClass("fBold")}function no_result(d,e){var c=1;if(d!=undefined&&d.first_time_flg!=undefined){c=d.first_time_flg}if(d!=""&&d!=undefined&&d!=null&&d.a_data!=""&&d.a_data!=undefined&&d.a_data!=null){var b=(d.f_cnt!=""&&d.f_cnt!=undefined&&d.f_cnt!=null)?parseInt(d.f_cnt):100;if(b<e.limit&&c==1){return false}}var a="";jQuery('[id="your_nw_no_data_cntnr"]').remove();jQuery('[id="your_nw_no_data_first_cntnr"]').remove();if(c==1){var f="noDataFrstMsg"}else{var f="noDataMsg"}a=jQuery("#"+f).html().replace("{:cntnr}","cntnr");jQuery("#feeds_loader").addClass("hide");display_data(a,'[id="user_list_cntnr"]',{draw_type:"append"})}function createLoader(){jQuery("#display_map_loader").html('<div id="shwLoader" class=" w100 h100"><div class="w100" style="text-align:center"><img src="'+site_url_fa+'img/4atheme/map_loader.gif"></div><br /></div>').show()}document_obj_fa.on("click",'[id="is_current"]',function(){if(jQuery("#is_current").is(":checked")){jQuery("#is_current").val(1)}else{jQuery("#is_current").val(0)}});document_obj_fa.on("click",'[id="registered"]',function(){var a=jQuery(this);if(a.is(":checked")){a.val(1)}else{a.val(0)}trigger_advanced_search(a)});document_obj_fa.on("click",'[id="non-registered"]',function(){var a=jQuery(this);if(a.is(":checked")){a.val(1)}else{a.val(0)}trigger_advanced_search(a)});jQuery("#hide_map_btn").click(function(){jQuery("#map_container").animate({height:"toggle"})});function trigger_advanced_search(a){a.closest("form").find('a[id="your_nw_submit_btn"]').click()}function hideLoader(){jQuery("#display_map_loader").html("")}document_obj_fa.on("keydown",'[id^="friend_loc"],[id^="friend_name"],[id^="ins_name"]',function(a){if(a.keyCode==13){trigger_advanced_search(jQuery(this))}});document_obj_fa.on("click",'[id^="filter_ynw_opt_c_"],[id^="filter_ynw_opt_b_"],[id^="filter_ynw_opt_s_"],[id^="inst_list_nw_"],[id^="type_filter_"],[id^="filter_ynw_opt_groups_"]',function(){filter_all_options();trigger_advanced_search(jQuery(this))});function filter_all_options(){var f=new Array(),h=new Array(),i=new Array(),c=new Array(),a=new Array(),b=new Array();jQuery('input[id^="inst_list_nw_"]').each(function(){if(this.checked){f.push(jQuery(this).attr("value"))}});jQuery('input[id^="filter_ynw_opt_c_"]').each(function(){if(this.checked){h.push(jQuery(this).attr("value"))}});jQuery('input[id^="filter_ynw_opt_b_"]').each(function(){if(this.checked){i.push(jQuery(this).attr("value"))}});jQuery('input[id^="filter_ynw_opt_s_"]').each(function(){if(this.checked){c.push(jQuery(this).attr("value"))}});jQuery('input[id^="type_filter_"]').each(function(){if(this.checked){a.push(jQuery(this).attr("value"))}});jQuery('input[id^="filter_ynw_opt_groups_"]').each(function(){if(this.checked){b.push(jQuery(this).attr("value"))}});var g=(h.length===0)?1:0,d=(i.length===0)?1:0,e=(c.length===0)?1:0;jQuery.ajax({type:"POST",url:site_url_fa+"circuits/filter_course_batch_specliztn/"+jQuery("#base_ckt_id").val(),dataType:"JSON",data:{inst_arr:f,course_arr:h,batch_arr:i,spec_arr:c,type_arr:a,groups_arr:b},success:function(j){if(j.is_loggeddin&&j.is_loggeddin==2){if(j.msg){fa_alert({content:j.msg})}return}if(j.status&&j.status==1){if(g==1){draw_filter_block(j.course,"course_nw_cntr")}if(d==1){draw_filter_block(j.batch,"batch_nw_cntr")}if(e==1){draw_filter_block(j.specialization,"specialization_nw_cntr")}}else{fa_alert({content:fa_translate_msgs("please_try_again_later")})}}})}function draw_filter_block(d,h){var g="",a="",j="",f="",k="",c="",e="",b=0;switch(h){case"course_nw_cntr":g=fa_translate_msgs("no_course");a="fa_filter_course";j=fa_translate("search_by_course");f="fa_filter_course_cntr_";k="filter_ynw_opt_c_";c="course_list[]";break;case"batch_nw_cntr":g=fa_translate_msgs("no_batch");a="fa_filter_batch";j=fa_translate("search_by_batch");f="fa_filter_batch_cntr_";k="filter_ynw_opt_b_";c="batch_list[]";b=1;break;case"specialization_nw_cntr":g=fa_translate_msgs("no_specialization");a="fa_filter_specialization";j=fa_translate("search_by_spec");f="fa_filter_specialization_cntr";k="filter_ynw_opt_s_";c="specialization_list[]";break}if(Object.keys(d).length>0){var i=Object.keys(d).length;e="";if(i>10){e+='<div class="row  mbtm_10">\n                    <div class="input-field col s12 no-padding  no_margin">\n                        <input id="'+a+'" type="text" class="validate  no_margin h24" placeholder="'+j+'">\n                   </div>\n                </div>'}e+='<div class="row">   \n                    <div class=" col s12 no-padding" style="max-height:150px; overflow-y:auto;"> ';jQuery.each(d,function(l,m){var n=(b==1)?m.name:m.id,o=jQuery.trim(m.name);e+=' <div class="mbtm_5" id="'+f+m.id+'" fa_filter_keyword="'+m.name+'">  \n                                   <input type="checkbox" class="filled-in posRel mLft-15" name="'+c+'" id="'+k+m.id+'" value="'+n+'">    \n                                   <label for="'+k+m.id+'" class="grey-text text-darken-3 hauto nowrapp" title="'+m.name+'">'+truncateText(o,25,"truncate")+"</label>    \n                               </div> "});e+=" </div></div> "}else{var e='<div class="collapsible-body borderNone " style="display: block;">'+g+"</div>"}jQuery('[id="'+h+'"]').html(e)}document_obj_fa.on("click",'[id="yn_search_btn"]',function(a){a.preventDefault();jQuery(".button-collapse").trigger("click")});document_obj_fa.on("click",'[id^="filter_ynw_opt_chapter_"]',function(a){jQuery('[id="search_ckt_id"]').val("");trigger_advanced_search(jQuery(this))});function chapter_members(d){var c={},a=jQuery("#map_click_filter").val(),b=(a!=1)?1:"";c.search_ckt_id=d;c.topic_cat_id=jQuery('[id="topic_cat_id"]').val();c.topic_subcat_id=jQuery('[id="topic_subcat_id"]').val();show_friends_list(b,c,c)}function get_final_circuit_id(){var a=(jQuery.trim(jQuery('[id="search_ckt_id"]').val())!=""&&jQuery('[id="search_ckt_id"]').val()!=undefined)?jQuery('[id="search_ckt_id"]').val():jQuery('[id="base_ckt_id"]').val();return a};